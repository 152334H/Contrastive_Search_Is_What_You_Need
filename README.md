# Contrastive Search Might Be All You Need
**Authors**: Yixuan Su and Nigel Collier

This repository contains code other related resources of our paper ["Contrastive Search Might Be All You Need"]().

****
If you find our paper and resources useful, please kindly leave a star and cite our papers. Thanks!

```bibtex
@article{su2022contrastive,
  title={A Contrastive Framework for Neural Text Generation},
  author={Su, Yixuan and Lan, Tian and Wang, Yan and Yogatama, Dani and Kong, Lingpeng and Collier, Nigel},
  journal={arXiv preprint arXiv:2202.06417},
  year={2022}
}
```

****

### News:
* [2022/10/xx]  is publicly released!

****

<span id='all_catelogue'/>

### Catalogue:
* <a href='#introduction'>1. Introduction</a>
* <a href='#reproduce_examples'>2. Reproducing Examples Provided in the Paper</a>
    * <a href='#use_transformers'>2.1. Using Huggingface Transformers</a>
    * <a href='#use_simctg'>2.2. Using SimCTG Package</a>
        * <a href='#install_simctg'>2.2.1. Install SimCTG Package</a>
        * <a href='#simctg_table_1'>2.2.2. Example in Table 1</a>
    

****

<span id='introduction'/>

#### 1. Introduction: <a href='#all_catelogue'>[Back to Top]</a>

****


<span id='reproduce_examples'/>


#### 2. Reproducing Examples Provided in the Paper: <a href='#all_catelogue'>[Back to Top]</a>
In this section, we demonstrate two ways of reproducing the examples generated by contrastive search provided in our paper.

<span id='use_transformers'/>

##### 2.1. Using Huggingface Transformers: <a href='#all_catelogue'>[Back to Top]</a>

To be completed.

<span id='use_simctg'/>

##### 2.2. Using SimCTG Package: <a href='#all_catelogue'>[Back to Top]</a>

<span id='install_simctg'/>

###### 2.2.1. Install SimCTG Package: <a href='#all_catelogue'>[Back to Top]</a>

To install the package, please run the following command:

```yaml
pip install simctg --upgrade
```

<span id='simctg_table_1'/>

###### 2.2.2. Example in Table 1: <a href='#all_catelogue'>[Back to Top]</a>

To reproduce our example provided in Table 1, please run the following command:
```python
# load the LMs
import torch
from simctg.simctggpt import SimCTGGPT
model_name = r'gpt2-large'
model = SimCTGGPT(model_name)
model.eval()
tokenizer = model.tokenizer
eos_token_id = tokenizer.eos_token_id

# prepare the prefix
prefix_text = r"Kobe Bryant is"
tokens = tokenizer.tokenize(prefix_text)
input_ids = tokenizer.convert_tokens_to_ids(tokens)
input_ids = torch.LongTensor(input_ids).view(1,-1)

# generate the result with contrastive search
beam_width, alpha, decoding_len = 4, 0.6, 256
output = model.fast_contrastive_search(input_ids=input_ids, beam_width=beam_width, 
                                       alpha=alpha, decoding_len=decoding_len,
                                      end_of_sequence_token_id = eos_token_id, early_stop = True) 
print("Output:\n" + 100 * '-')
print(tokenizer.decode(output))
print("" + 100 * '-')
```

<details>
<summary><b>Model Output: [click to expand]</b></summary>
  
```
Output:
----------------------------------------------------------------------------------------------------
Kobe Bryant is the best player in the world.

I know this is a bold statement to make, but it's true. He may have won a lot of games, but his impact
on the game is immeasurable. Kobe is one of the most popular players in the world, and that's no small
feat when you consider how many people play video games, watch sports, listen to music, and have social
media accounts.

Kobe has made a career out of being a role model for young people, and he does an amazing job of that
every time he steps on the court. His career stats are impressive, but what makes him stand out is the
way he goes about his business. When he's on the court, he's the center of attention, and it's easy to
see why.

The Lakers' All-Star point guard wears a smile on his face like no other. He's always in the right place
at the right time, making the right play at the right time, and doing the right thing in the right way.
He's not afraid to get his hands dirty, and he never shies away from a physical confrontation.

Kobe's personality is something that can't be taught, and it's a big reason why...
----------------------------------------------------------------------------------------------------
```
</details>



